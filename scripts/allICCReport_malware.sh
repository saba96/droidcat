#!/bin/bash

(test $# -lt 0) && (echo "too few arguments") && exit 0

rep=${1:-"malwareLogs_secondrep"}
TRACEDIR=/home/hcai/testbed/$rep/

resultdir=/home/hcai/testbed/results/ICCReport/$rep
mkdir -p $resultdir
resultlog=$resultdir/log.ICCReport.all
> $resultlog
resultidx=$resultdir/idx.ICCReport
>> $resultidx
for ((i=1;i<=415;i++))
do
	if [ ! -s $TRACEDIR/${i}.apk.logcat ];
	then
		continue
	fi
	echo "result for ${i}.apk" >> $resultlog 2>&1
	/home/hcai/bin/getpackage.sh /home/hcai/testbed/cg.instrumented/malware/org/${i}-org.apk >> $resultlog 2>&1
	sh /home/hcai/testbed/ICCReport.sh \
		/home/hcai/testbed/cg.instrumented/malware/org/${i}-org.apk \
		$TRACEDIR/${i}.apk.logcat >> $resultlog 2>&1
	echo "$i" >> $resultidx
done
mv /home/hcai/testbed/{gicc.txt,dataicc.txt,extraicc.txt,icclink.txt,icccov.txt,bothdataicc.txt} $resultdir 

exit 0
